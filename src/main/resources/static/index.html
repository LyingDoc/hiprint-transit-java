<!DOCTYPE html>
<html lang="en">
<head>
    <title>HTML TO PDF</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="./css/print-lock@0.0.60.css" />
    <link rel="stylesheet" type="text/css" media="print" href="./css/print-lock@0.0.60.css" />
    <!-- 如果觉得慢,可换成本地链接 -->
    <script src="./js/jquery@3.7.1.js"></script>
    <script src="./js/jquery.minicolors@2.3.6.min.js"></script>
    <script src="./js/bwip-js@4.8.0.js"></script>
    <script src="./js/html2canvas@1.4.1.js"></script>
    <script src="./js/JsBarcode@3.12.1.all.min.js"></script>
    <script src="./js/jspdf.umd@4.0.0.min.js"></script>
    <script src="./js/nzh@1.0.14.min.js"></script>
    <script src="./js/socket.io@4.8.3.min.js"></script>
    <script src="./js/vue-plugin-hiprint@0.60.0.js"></script>

    <!-- axios网络请求 -->
    <script src="./js/axios@1.13.2.min.js"></script>
</head>

<body>
<div id="hiprintTemplate" class="hiprintTemplate"></div>
</body>
<script defer>
    window.autoConnect = false;
    const templateDiv = document.querySelector("#hiprintTemplate.hiprintTemplate")
    function renderHtml() {
        hiprint.init({});
        // 模拟网络请求然后,创建模板
        const search = window.location.search;
        const id = search.split("=")[1];
        console.log(id);
        if (!id) return;
        axios.get("/api/template/get", {
                params: {
                    id: id,
                },
            })
            .then((res) => {
                let result = res.data;
                // 创建模板
                if (result.code === 200) {
                    let hiprintTemplate = new hiprint.PrintTemplate({
                        template: result.data.template,
                    });
                    // 渲染模板
                    let htmlJq = hiprintTemplate.getHtml(result.data.printData);
                    templateDiv.appendChild(htmlJq[0]);
                } else {
                    templateDiv.appendChild($(`<div class="hiprint-printTemplate">获取模板失败:${JSON.stringify(res.data.msg)}</div>`)[0]);
                }
            })
            .catch((error) => {
                console.log(error);
                templateDiv.appendChild($(`<div class="hiprint-printTemplate">${JSON.stringify(error.data.msg)}</div>`)[0]);
            });
    }
    renderHtml();

</script>

</html>
